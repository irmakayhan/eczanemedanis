<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eczaneme Danış | Premium Sağlık Ekosistemi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* --- PREMIUM THEME VARIABLES --- */
        :root {
            --primary-gradient: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%);
            --primary-color: #FF416C;
            --secondary-color: #2D3436;
            --accent-color: #00b894;
            --bg-body: #F0F2F5;
            --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            --sidebar-width: 280px;
            --radius-xl: 24px;
            --radius-md: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--secondary-color);
            margin: 0;
            overflow-x: hidden;
            display: flex;
        }

        .app-container { display: flex; width: 100%; min-height: 100vh; }

        /* SIDEBAR (Desktop) */
        .sidebar {
            width: var(--sidebar-width); background: white; padding: 30px; display: flex; flex-direction: column;
            position: fixed; height: 100vh; border-right: 1px solid rgba(0,0,0,0.05); z-index: 1000;
        }
        .logo-area {
            display: flex; align-items: center; gap: 12px; font-size: 22px; font-weight: 800;
            color: var(--secondary-color); margin-bottom: 50px; text-decoration: none;
        }
        .logo-icon {
            width: 40px; height: 40px; background: var(--primary-gradient); color: white;
            border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;
        }
        .nav-menu { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 10px; }
        .nav-btn {
            display: flex; align-items: center; gap: 15px; padding: 16px 20px;
            border-radius: var(--radius-md); color: #636e72; text-decoration: none;
            font-weight: 500; transition: all 0.3s ease; cursor: pointer;
        }
        .nav-btn:hover { background: #fff0f3; color: var(--primary-color); transform: translateX(5px); }
        .nav-btn.active { background: var(--primary-gradient); color: white; box-shadow: 0 10px 20px rgba(255, 65, 108, 0.3); }
        
        #admin-link { display: none; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
        #admin-link .nav-btn { color: var(--accent-color); background: rgba(0, 184, 148, 0.1); }

        /* MAIN CONTENT */
        .main-content {
            flex: 1; margin-left: var(--sidebar-width); padding: 40px; max-width: 1600px;
        }
        .top-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .user-pill {
            background: white; padding: 8px 15px 8px 8px; border-radius: 50px;
            display: flex; align-items: center; gap: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            cursor: pointer; transition: 0.2s;
        }
        .user-pill:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: #dfe6e9; display: flex; align-items: center; justify-content: center; color: #636e72; }
        .avatar.pharmacist { background: var(--accent-color); color: white; }

        /* --- DASHBOARD --- */
        .hero-banner {
            background: var(--primary-gradient); color: white; border-radius: var(--radius-xl); padding: 40px;
            position: relative; overflow: hidden; box-shadow: 0 20px 40px rgba(255, 75, 43, 0.25); margin-bottom: 40px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .hero-content { position: relative; z-index: 2; max-width: 600px; }
        .hero-btn {
            background: white; color: var(--primary-color); padding: 15px 35px; border-radius: 50px;
            font-weight: 700; border: none; cursor: pointer; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .hero-pattern { position: absolute; right: -50px; top: -50px; font-size: 300px; opacity: 0.1; transform: rotate(15deg); }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-bottom: 40px; }
        .stat-card {
            background: white; padding: 25px; border-radius: var(--radius-md);
            box-shadow: var(--card-shadow); display: flex; align-items: center; gap: 20px; transition: 0.3s;
        }

        /* --- PAGE SECTIONS --- */
        .page-section { display: none; animation: fadeIn 0.4s ease-out; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- VITAMIN WIZARD & KVKK --- */
        .wizard-container { background: white; border-radius: var(--radius-xl); padding: 40px; box-shadow: var(--card-shadow); max-width: 800px; margin: 0 auto; }
        .progress-bar { width: 100%; height: 6px; background: #eee; border-radius: 10px; margin-bottom: 30px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary-gradient); width: 0%; transition: 0.5s; }
        
        .kvkk-box {
            background: #f8f9fa; border: 1px solid #eee; padding: 20px; border-radius: 12px;
            height: 150px; overflow-y: scroll; font-size: 12px; color: #666; margin-bottom: 20px;
            text-align: left; line-height: 1.6;
        }
        .kvkk-label { display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--secondary-color); }
        .kvkk-checkbox { width: 18px; height: 18px; accent-color: var(--primary-color); }

        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .option-card {
            border: 2px solid #eee; padding: 20px; border-radius: var(--radius-md); cursor: pointer;
            text-align: center; transition: 0.2s;
        }
        .option-card:hover, .option-card.selected { border-color: var(--primary-color); background: #fff0f3; color: var(--primary-color); }

        .test-input-group { text-align: left; margin-bottom: 15px; }
        .test-input { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; outline: none; transition: 0.3s; }
        .test-input:focus { border-color: var(--primary-color); }
        .btn-next-q { background: var(--secondary-color); color: white; border: none; padding: 15px 40px; border-radius: 12px; cursor: pointer; font-size: 16px; margin-top: 20px; }

        /* --- FORUM & ADMIN --- */
        .forum-feed { max-width: 900px; margin: 0 auto; }
        .forum-post { background: white; padding: 25px; border-radius: var(--radius-md); box-shadow: var(--card-shadow); margin-bottom: 25px; }
        .verified-badge { background: rgba(0, 184, 148, 0.1); color: var(--accent-color); padding: 5px 10px; border-radius: 50px; font-size: 12px; font-weight: 700; display: inline-flex; align-items: center; gap: 5px; }

        .admin-card { border-left: 5px solid #f1c40f; background: white; padding: 25px; border-radius: var(--radius-md); margin-bottom: 20px; box-shadow: var(--card-shadow); }
        .admin-header { display: flex; justify-content: space-between; font-size: 13px; color: #888; margin-bottom: 10px; }
        .admin-input { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 12px; font-family: inherit; margin: 15px 0; }
        
        .btn-primary { background: var(--primary-gradient); color: white; border: none; padding: 12px 25px; border-radius: 50px; cursor: pointer; font-weight: 600; box-shadow: 0 5px 15px rgba(255, 65, 108, 0.3); }

        .faq-container { margin-top: 50px; }
        .faq-item { background: white; margin-bottom: 10px; border-radius: var(--radius-md); overflow: hidden; box-shadow: var(--card-shadow); }
        .faq-question { padding: 20px; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .faq-answer { padding: 0 20px; max-height: 0; overflow: hidden; transition: 0.3s ease; color: #636e72; font-size: 14px; line-height: 1.6; }
        .faq-item.active .faq-answer { padding-bottom: 20px; max-height: 200px; }
        .faq-item.active .fa-chevron-down { transform: rotate(180deg); transition: 0.3s; }

        /* --- PHARMACY MAP & LIST --- */
        .pharmacy-card {
            background: white; padding: 25px; border-radius: var(--radius-md); margin-bottom: 20px;
            box-shadow: var(--card-shadow); display: flex; flex-direction: column; gap: 20px;
        }
        .pharm-status { font-size: 12px; font-weight: 700; padding: 5px 12px; border-radius: 20px; }
        .status-open { background: #e6fffa; color: #00b894; }
        .status-closed { background: #fff5f5; color: #d63031; }
        .action-buttons { display: flex; gap: 10px; width: 100%; }
        .btn-whatsapp {
            background: #25D366; color: white; border: none; padding: 10px 20px; border-radius: 50px;
            font-weight: 600; cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; transition: 0.2s; flex: 1;
        }
        .btn-map {
            background: #f1f2f6; color: #2D3436; border: none; padding: 10px 20px; border-radius: 50px;
            font-weight: 600; cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; transition: 0.2s; flex: 1;
        }
        /* En Yakın Eczane Etiketi */
        .nearest-badge {
            background: var(--primary-gradient); color: white; 
            font-size: 11px; font-weight: 800; padding: 4px 10px; 
            border-radius: 20px; display: inline-block; margin-left: 10px;
            box-shadow: 0 4px 10px rgba(255, 65, 108, 0.4);
        }
        /* Partner Eczane Vurgusu */
        .partner-card { border: 2px solid var(--primary-color); }

        /* --- FLOATING AI BUTTON --- */
        .fab-ai {
            position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px;
            background: var(--primary-gradient); border-radius: 50%; display: flex; justify-content: center; align-items: center;
            color: white; font-size: 28px; border: none; cursor: pointer;
            box-shadow: 0 10px 25px rgba(255, 65, 108, 0.4); z-index: 1500;
            animation: pulse 2s infinite; transition: 0.3s;
        }
        .fab-ai:hover { transform: scale(1.1); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 65, 108, 0.4); } 70% { box-shadow: 0 0 0 20px rgba(255, 65, 108, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 65, 108, 0); } }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white; padding: 40px; border-radius: var(--radius-xl);
            width: 100%; max-width: 450px; text-align: center; box-shadow: var(--card-shadow);
            animation: slideUp 0.3s ease-out; position: relative;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-close { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: #666; }
        .input-group input, .input-group textarea {
            width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px;
            font-family: inherit; font-size: 14px; outline: none; transition: 0.2s;
        }
        .input-group input:focus { border-color: var(--primary-color); }

        /* --- TOAST --- */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 3000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        /* --- MOBILE NAV --- */
        .mobile-nav {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.98); backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05); padding: 6px 0;
            justify-content: space-around; z-index: 2000;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.03);
        }
        .mob-link { 
            display: flex; flex-direction: column; align-items: center; gap: 2px;
            color: #b2bec3; text-decoration: none; font-size: 10px; font-weight: 600;
        }
        .mob-link.active { color: var(--primary-color); }
        .mob-link i { font-size: 18px; margin-bottom: 2px; }

        /* --- BACK BUTTON STYLE --- */
        .back-nav-container {
            display: flex; align-items: center; gap: 15px; margin-bottom: 20px;
        }
        .btn-back-circle {
            width: 40px; height: 40px; border-radius: 50%; background: white;
            border: 1px solid #eee; display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: var(--secondary-color); box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: 0.2s;
        }
        .btn-back-circle:active { transform: scale(0.95); }

        /* --- AI CHAT STYLE --- */
        .ai-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px 18px; border-radius: 15px; max-width: 80%; font-size: 14px; line-height: 1.4; }
        .msg.bot { background: #fff; border-bottom-left-radius: 0; align-self: flex-start; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .msg.user { background: var(--primary-color); color: white; border-bottom-right-radius: 0; align-self: flex-end; box-shadow: 0 2px 5px rgba(255,65,108,0.3); }

        @media (max-width: 1024px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 20px; padding-bottom: 70px; }
            .mobile-nav { display: flex; }
            .fab-ai { bottom: 80px; right: 20px; width: 55px; height: 55px; } 
            .stats-grid { grid-template-columns: 1fr; }
            .hero-banner { text-align: center; flex-direction: column; gap: 20px; }
            .action-buttons { width: 100%; }
            .btn-whatsapp, .btn-map { flex: 1; justify-content: center; }
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <a href="#" class="logo-area">
            <div class="logo-icon"><i class="fas fa-plus"></i></div> Eczaneme Danış
        </a>
        <ul class="nav-menu">
            <li class="nav-btn active" onclick="navTo('home', this)"><i class="fas fa-home"></i> Ana Sayfa</li>
            <li class="nav-btn" onclick="navTo('test', this)"><i class="fas fa-dna"></i> Vitamin Testi</li>
            <li class="nav-btn" onclick="navTo('map', this)"><i class="fas fa-map-marked-alt"></i> Nöbetçi Eczaneler</li>
            <li class="nav-btn" onclick="navTo('forum', this)"><i class="fas fa-users"></i> Topluluk Forumu</li>
            <li class="nav-btn" onclick="navTo('ai', this)"><i class="fas fa-robot"></i> AI Asistan</li>
            
            <div id="admin-link">
                <li class="nav-btn" onclick="navTo('admin', this)"><i class="fas fa-user-shield"></i> Eczacı Paneli (Admin)</li>
            </div>
        </ul>
        <div style="margin-top: auto; padding: 20px; background: #f8f9fa; border-radius: 16px;">
            <div style="font-size: 12px; color: #888; margin-bottom: 10px;">GİRİŞ YAP</div>
            <button onclick="openLoginModal()" style="width: 100%; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 10px; cursor: pointer; font-weight: 600;">Eczacı Girişi</button>
        </div>
    </aside>

    <main class="main-content">
        <header class="top-header">
            <div class="welcome-text">
                <h1 id="header-title">Merhaba</h1>
                <p id="header-sub">Bugün sağlığın için ne yapmak istersin?</p>
            </div>
            <div class="user-pill" onclick="openLoginModal()">
                <div class="avatar" id="header-avatar"><i class="fas fa-user"></i></div>
                <span id="header-user" style="font-weight: 600; font-size: 14px; margin-right: 10px;">Giriş Yapılmadı</span>
            </div>
        </header>

        <section id="page-home" class="page-section active">
            <div class="hero-banner">
                <i class="fas fa-heartbeat hero-pattern"></i>
                <div class="hero-content">
                    <div style="background: rgba(255,255,255,0.2); width: fit-content; padding: 5px 15px; border-radius: 20px; font-size: 12px; margin-bottom: 15px; font-weight: 600;">
                        <i class="fas fa-qrcode"></i> QR Girişi Başarılı
                    </div>
                    <h2 class="hero-title">Sağlık Asistanın Cebinde.</h2>
                    <p class="hero-desc">Eczanedesin ve kafan mı karışık? Vitamin analizini hemen yap veya eczacıya WhatsApp'tan yaz.</p>
                    <button class="hero-btn" onclick="navTo('test')">Analizi Başlat <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card" onclick="navTo('map')">
                    <div class="stat-icon" style="background: #e1f5fe; color: #0288d1;"><i class="fas fa-map-marker-alt"></i></div>
                    <div class="stat-info"><h3>2</h3><p>Yakın Eczane</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #e8f5e9; color: #2e7d32;"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-info"><h3>%98</h3><p>Memnuniyet</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #fff3e0; color: #ef6c00;"><i class="fas fa-bolt"></i></div>
                    <div class="stat-info"><h3>0.2sn</h3><p>AI Yanıt Hızı</p></div>
                </div>
            </div>
        </section>

        <section id="page-test" class="page-section">
            <div class="back-nav-container">
                <div class="btn-back-circle" onclick="navTo('home')"><i class="fas fa-arrow-left"></i></div>
                <h3 style="margin:0;">Ana Menü</h3>
            </div>
            <div class="wizard-container">
                <div id="test-intro">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">Gelişmiş Sağlık Analizi</h2>
                        <p style="color: #666;">Teste başlamadan önce lütfen aydınlatma metnini onaylayın.</p>
                    </div>
                    <div class="kvkk-box">
                        <strong>KİŞİSEL VERİLERİN KORUNMASI AYDINLATMA METNİ</strong><br><br>
                        6698 sayılı Kişisel Verilerin Korunması Kanunu (“KVKK”) uyarınca, sağlık verileriniz ve test sonuçlarınız; "Eczaneme Danış" uygulaması kapsamında, size özel vitamin ve takviye önerileri sunulabilmesi amacıyla işlenecektir.<br><br>
                        Verileriniz, sistem algoritmaları tarafından anlık olarak analiz edilecek ve herhangi bir üçüncü tarafla paylaşılmayacaktır. Bu test tıbbi tanı yerine geçmez, sadece eczacınıza danışmanız için ön bilgi niteliğindedir.<br><br>
                        Onay vererek, sağlık verilerinizin bu kapsamda işlenmesini kabul etmiş sayılırsınız.
                    </div>
                    <label class="kvkk-label" style="margin-bottom: 20px;">
                        <input type="checkbox" id="kvkk-check" class="kvkk-checkbox">
                        Aydınlatma metnini okudum, sağlık verilerimin işlenmesini onaylıyorum.
                    </label>
                    <button class="hero-btn" style="width: 100%; border-radius: 12px;" onclick="checkKvkkAndStart()">Teste Başla <i class="fas fa-arrow-right"></i></button>
                </div>

                <div id="quiz-area" style="display: none;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">Gelişmiş Sağlık Analizi</h2>
                        <p style="color: #666;">Yapay zeka, verdiğiniz 10 cevaba göre ihtiyaç haritası çıkaracak.</p>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" id="p-bar"></div></div>
                    <h3 id="q-text-display">Soru Yükleniyor...</h3>
                    <div id="q-content"></div>
                </div>

                <div id="step-result" style="display: none; text-align: center; padding: 20px;">
                    <div style="width: 80px; height: 80px; background: #e8f5e9; color: var(--accent-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px;">
                        <i class="fas fa-check"></i>
                    </div>
                    <h2 id="result-title" style="color: var(--primary-color);">Sonuç Hesaplanıyor</h2>
                    <p id="result-desc" style="margin-bottom: 30px; color: #666; font-size: 15px; line-height: 1.6;">Analiz tamamlandı.</p>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: left;">
                        <h4 style="margin:0 0 10px;">Vücut Analiziniz:</h4>
                        <div id="bmi-result" style="font-size: 14px; color: #555;"></div>
                    </div>
                    <div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 10px; font-size: 13px;">⚠️ <strong>Yasal Uyarı:</strong> Bu sonuç tıbbi tanı değildir. Takviye kullanmadan önce eczacınıza danışın.</div>
                    <button class="hero-btn" style="margin-top: 30px; background: #333; color: white;" onclick="navTo('home')">Panele Dön</button>
                    <button class="hero-btn" style="margin-top: 10px; background: white; color: #333; border: 1px solid #ddd; box-shadow: none;" onclick="resetTest()">Testi Tekrarla</button>
                </div>
            </div>
        </section>

        <section id="page-map" class="page-section">
            <div class="back-nav-container">
                <div class="btn-back-circle" onclick="navTo('home')"><i class="fas fa-arrow-left"></i></div>
                <h3 style="margin:0;">Ana Menü</h3>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h2 style="margin-bottom: 10px;">Size En Yakın Eczane Haritası</h2>
                <div style="width: 100%; height: 250px; border-radius: 16px; overflow: hidden; background: #eee; box-shadow: var(--card-shadow);">
                    <iframe id="home-map" width="100%" height="100%" frameborder="0" style="border:0;" src=""></iframe>
                </div>
            </div>

            <h3 style="color: var(--primary-color); margin-bottom: 15px;">Anlaşmalı Eczanelerimiz</h3>
            <div id="partner-list-container">
                </div>

            <h3 style="color: #666; margin-top: 40px; margin-bottom: 15px;">Bugünün Nöbetçi Eczaneleri (Çiğli)</h3>
            <div id="duty-list-container">
                <p style="text-align:center; color:#999; padding:20px;">
                    <i class="fas fa-spinner fa-spin"></i> Listeler yükleniyor...
                </p>
            </div>
        </section>

        <section id="page-forum" class="page-section">
            <div class="back-nav-container">
                <div class="btn-back-circle" onclick="navTo('home')"><i class="fas fa-arrow-left"></i></div>
                <h3 style="margin:0;">Ana Menü</h3>
            </div>
            <div class="forum-feed">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2>Topluluk Soruları</h2>
                    <button class="btn-primary" onclick="openAskModal()"><i class="fas fa-plus"></i> Soru Sor</button>
                </div>
                <div id="forum-container">
                    <div style="text-align:center; padding:20px;">Yükleniyor...</div>
                </div>
                <div class="faq-container">
                    <h3 style="margin-bottom: 20px; color: var(--primary-color);">Sıkça Sorulan Sorular</h3>
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">Eczaneniz hafta sonu açık mı? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-answer">Cumartesi günleri 09:00 - 13:00 arası açığız. Pazar günleri nöbetçi eczaneler hizmet verir.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFaq(this)">İlaçlarımı nasıl saklamalıyım? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-answer">Oda sıcaklığında, nemsiz ve 25 derece altında saklayınız.</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-admin" class="page-section">
            <div style="background: white; padding: 25px; border-radius: 20px; box-shadow: var(--card-shadow); max-width: 900px; margin: 0 auto;">
                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px;">
                    <h2 style="margin:0; color: var(--secondary-color);">
                        <i class="fas fa-user-shield" style="color: var(--accent-color);"></i> Yönetim Paneli
                    </h2>
                    <button onclick="performLogout()" style="background: #ff7675; color: white; border: none; padding: 8px 20px; border-radius: 12px; cursor: pointer; font-weight: 600;">
                        <i class="fas fa-sign-out-alt"></i> Çıkış
                    </button>
                </div>
                <h4 style="margin-bottom:15px; color:#666;">Bekleyen Sorular</h4>
                <div id="admin-container">
                    <p style="color: #999; text-align: center; padding: 20px;">Yükleniyor...</p>
                </div>
            </div>
        </section>

        <section id="page-ai" class="page-section">
            <div class="back-nav-container">
                <div class="btn-back-circle" onclick="navTo('home')"><i class="fas fa-arrow-left"></i></div>
                <h3 style="margin:0;">Ana Menü</h3>
            </div>
            <div style="background: white; border-radius: 24px; height: 70vh; display: flex; flex-direction: column; box-shadow: var(--card-shadow);">
                <div style="padding: 20px; border-bottom: 1px solid #eee; font-weight: 700; color: var(--primary-color);">AI Asistan (Canlı)</div>
                <div id="ai-messages" class="ai-messages" style="flex: 1; background: #f9f9f9;">
                    <div class="msg bot">
                        Merhaba! Ben eczacı verileriyle eğitilmiş özel bir yapay zekayım. Şikayetinizi yazın, yardımcı olayım.
                    </div>
                </div>
                <div style="padding: 20px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px;">
                    <input type="text" id="ai-input" placeholder="Yazın..." style="flex: 1; padding: 15px; border-radius: 50px; border: 1px solid #ddd; outline: none;" onkeypress="handleEnter(event)">
                    <button onclick="sendAiMessage()" style="width: 50px; height: 50px; background: var(--primary-gradient); color: white; border: none; border-radius: 50%;"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </section>
    </main>

    <button class="fab-ai" onclick="navTo('ai')"><i class="fas fa-robot"></i></button>

    <nav class="mobile-nav">
        <a href="#" class="mob-link active" onclick="navTo('home', this)"><i class="fas fa-home"></i> Ana Sayfa</a>
        <a href="#" class="mob-link" onclick="navTo('test', this)"><i class="fas fa-dna"></i> Test</a>
        <a href="#" class="mob-link" onclick="navTo('map', this)"><i class="fas fa-map-marked-alt"></i> Eczane</a>
        <a href="#" class="mob-link" onclick="navTo('forum', this)"><i class="fas fa-users"></i> Forum</a>
    </nav>

    <div id="login-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('login-modal')">×</span>
            <h2 style="margin-bottom: 10px;">Eczacı Girişi</h2>
            <div class="input-group">
                <label>GLN (Ruhsat) Numarası</label>
                <input type="text" id="gln-input" placeholder="8680001...">
            </div>
            <button class="hero-btn" style="width: 100%; box-shadow: none;" onclick="performLogin()">Giriş Yap</button>
        </div>
    </div>

    <div id="ask-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: left;">
            <span class="modal-close" onclick="closeModal('ask-modal')">×</span>
            <h2 style="margin-bottom: 20px;">Soru Sor</h2>
            <div class="input-group">
                <label>Konu</label>
                <input type="text" id="q-topic" placeholder="Örn: İlaç Etkileşimi">
            </div>
            <div class="input-group">
                <label>Sorunuz</label>
                <textarea id="q-text" rows="3" placeholder="Detaylı yazınız..."></textarea>
            </div>
            <button class="btn-primary" style="width: 100%;" onclick="submitQuestion()">Gönder (Onay Bekliyor)</button>
        </div>
    </div>

    <div id="toast">İşlem Başarılı!</div>

    <script>
        const API_URL = "http://localhost:3000/api";

        // --- TEST SORULARI ---
        const questions = [
            { id: 1, type: 'option', text: "Önce sizi tanıyalım. Cinsiyetiniz?", options: [{txt:"Kadın", val:"F"}, {txt:"Erkek", val:"M"}] },
            { id: 2, type: 'input', text: "Yaşınız kaç?", inputType: "number", key: "age", placeholder: "Örn: 25" },
            { id: 3, type: 'double-input', text: "Vücut analizi için Boy ve Kilonuz?", inputs: [{key:"height", placeholder:"Boy (cm)"}, {key:"weight", placeholder:"Kilo (kg)"}] },
            { id: 4, type: 'option', text: "Size en çok ne yardımcı olurdu?", options: [{txt:"Sürekli Yorgunluk", val:"yorgunluk"}, {txt:"Saç Dökülmesi / Cilt", val:"sac_cilt"}, {txt:"Uyku Problemi", val:"uyku"}, {txt:"Eklem Ağrıları", val:"eklem"}]},
            { id: 5, type: 'option', text: "Beslenme düzeniniz nasıl?", options: [{txt:"Sebze ağırlıklı", val:"saglikli"}, {txt:"Fast-food / Dengesiz", val:"dengesiz"}] },
            { id: 6, type: 'option', text: "Güneş ışığına ne kadar maruz kalıyorsunuz?", options: [{txt:"Çok az (Ofis ortamı)", val:"gunes_az"}, {txt:"Yeterli", val:"gunes_cok"}] },
            { id: 7, type: 'option', text: "Günde ne kadar su içiyorsunuz?", options: [{txt:"1 litreden az", val:"su_az"}, {txt:"2 litre ve üzeri", val:"su_cok"}] },
            { id: 8, type: 'option', text: "Günlük stres seviyeniz?", options: [{txt:"Yüksek / Yoğun", val:"stres_yuksek"}, {txt:"Düşük / Sakin", val:"stres_dusuk"}] },
            { id: 9, type: 'option', text: "Kronik bir rahatsızlığınız var mı?", options: [{txt:"Evet", val:"hastalik_var"}, {txt:"Hayır", val:"hastalik_yok"}] },
            { id: 10, type: 'option', text: "Sigara veya alkol tüketimi?", options: [{txt:"Kullanıyorum", val:"toksik"}, {txt:"Kullanmıyorum", val:"temiz"}] }
        ];

        let currentQIndex = 0;
        let userData = {};

        document.addEventListener('DOMContentLoaded', () => { 
            renderForum();
            getLocationAndFindNearest(); // Konum ve Eczane Yükleme
        });

        // --- KONUM VE ÇİFT LİSTE MANTIĞI ---
        function getLocationAndFindNearest() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(processLocation, showError);
            } else {
                fetchAllPharmaciesAndRender(null, null);
            }
        }

        function processLocation(position) {
            const userLat = position.coords.latitude;
            const userLon = position.coords.longitude;
            fetchAllPharmaciesAndRender(userLat, userLon);
        }

        async function fetchAllPharmaciesAndRender(userLat, userLon) {
            try {
                // İki ayrı API'den verileri çekiyoruz
                const [partnersRes, dutyRes] = await Promise.all([
                    fetch(`${API_URL}/pharmacies/partners`),
                    fetch(`${API_URL}/pharmacies/duty`)
                ]);

                const partners = await partnersRes.json();
                const dutyList = await dutyRes.json();

                // Tüm eczaneleri tek bir havuzda topla (Sadece en yakını bulmak için)
                const allPharmacies = [...partners, ...dutyList];

                // Mesafe hesapla
                if (userLat && userLon) {
                    allPharmacies.forEach(p => p.distance = calculateDistance(userLat, userLon, p.lat, p.lon));
                    partners.forEach(p => p.distance = calculateDistance(userLat, userLon, p.lat, p.lon));
                    dutyList.forEach(p => p.distance = calculateDistance(userLat, userLon, p.lat, p.lon));
                    
                    // Nöbetçi listesini mesafeye göre sırala
                    dutyList.sort((a, b) => a.distance - b.distance);
                    // Genel havuzu sırala (En yakını haritaya koymak için)
                    allPharmacies.sort((a, b) => a.distance - b.distance);
                }

                // 1. Haritayı Güncelle (En yakın eczane hangisiyse - Anlaşmalı veya Nöbetçi)
                if (userLat && userLon && allPharmacies.length > 0) {
                    const closest = allPharmacies[0];
                    const mapFrame = document.getElementById('home-map');
                    mapFrame.src = `https://maps.google.com/maps?q=${closest.lat},${closest.lon}&z=15&output=embed`;
                } else {
                    document.getElementById('home-map').src = "https://maps.google.com/maps?q=Turkey&z=5&output=embed"; // Varsayılan
                }

                // 2. Listeleri Ekrana Bas
                renderPharmacyList(partners, 'partner-list-container', true); // true = Anlaşmalı stil
                renderPharmacyList(dutyList, 'duty-list-container', false); // false = Nöbetçi stil

            } catch (error) {
                console.error("Eczane listesi çekilemedi:", error);
            }
        }

        function renderPharmacyList(list, containerId, isPartner) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            list.forEach(pharm => {
                const statusClass = "status-open";
                // Anlaşmalı ise farklı stil, nöbetçi ise farklı
                const iconBg = isPartner ? "#ffebee" : "#fff3e0"; 
                const iconColor = isPartner ? "var(--primary-color)" : "#e67e22";
                const borderStyle = isPartner ? "border: 2px solid var(--primary-color);" : "";
                
                let distText = "Konum bekleniyor...";
                let mapLink = "#";

                if (pharm.distance !== undefined) {
                    const d = pharm.distance;
                    distText = d < 1 ? (d * 1000).toFixed(0) + " metre" : d.toFixed(1) + " km";
                    mapLink = `https://www.google.com/maps/dir/?api=1&destination=${pharm.lat},${pharm.lon}`;
                }

                container.innerHTML += `
                    <div class="pharmacy-card" style="${borderStyle}">
                        <div style="display: flex; gap: 20px; align-items: center; width: 100%;">
                            <div style="width: 60px; height: 60px; background: ${iconBg}; color: ${iconColor}; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">
                                <i class="fas fa-clinic-medical"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                    <h3 style="margin: 0;">${pharm.name}</h3>
                                    <span class="pharm-status ${statusClass}">${pharm.status}</span>
                                </div>
                                <p style="margin: 5px 0 0; color: #666; font-size: 14px;">
                                    ${pharm.address} <br>
                                    <i class="fas fa-location-arrow" style="font-size:12px; color:#aaa;"></i> ${distText}
                                </p>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <a href="https://wa.me/905551234567" target="_blank" class="btn-whatsapp"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                            <a href="${mapLink}" target="_blank" class="btn-map"><i class="fas fa-directions"></i> Yol Tarifi</a>
                        </div>
                    </div>
                `;
            });
        }

        // --- MESAFE FORMÜLÜ ---
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; const dLat = deg2rad(lat2 - lat1); const dLon = deg2rad(lon2 - lon1);
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
        function deg2rad(deg) { return deg * (Math.PI/180); }
        function showError(error) { fetchAllPharmaciesAndRender(null, null); }

        // --- TEST VE KVKK ---
        function showKvkkScreen() {
            document.getElementById('step-result').style.display = 'none';
            document.getElementById('quiz-area').style.display = 'none';
            document.getElementById('test-intro').style.display = 'block';
            document.getElementById('kvkk-check').checked = false;
        }
        function checkKvkkAndStart() {
            if (document.getElementById('kvkk-check').checked) {
                document.getElementById('test-intro').style.display = 'none';
                startTest();
            } else { showToast("Lütfen aydınlatma metnini onaylayın."); }
        }
        function startTest() { currentQIndex = 0; userData = {}; document.getElementById('quiz-area').style.display = 'block'; renderQuestion(); }
        function renderQuestion() {
            const q = questions[currentQIndex];
            document.getElementById('q-text-display').innerText = `${currentQIndex + 1}. ${q.text}`;
            const contentDiv = document.getElementById('q-content');
            contentDiv.innerHTML = "";
            document.getElementById('p-bar').style.width = ((currentQIndex) / questions.length) * 100 + '%';
            if (q.type === 'option') {
                contentDiv.className = "option-grid";
                q.options.forEach(opt => { contentDiv.innerHTML += `<div class="option-card" onclick="nextStep('${q.id}', '${opt.val}')">${opt.txt}</div>`; });
            } else if (q.type === 'input') {
                contentDiv.className = "";
                contentDiv.innerHTML = `<div class="test-input-group"><input type="number" id="inp-${q.key}" class="test-input" placeholder="${q.placeholder}"></div><button class="btn-next-q" onclick="saveInputAndNext('${q.key}')">Devam Et <i class="fas fa-arrow-right"></i></button>`;
            } else if (q.type === 'double-input') {
                contentDiv.className = "";
                contentDiv.innerHTML = `<div class="test-input-group"><input type="number" id="inp-${q.inputs[0].key}" class="test-input" placeholder="${q.inputs[0].placeholder}" style="margin-bottom:10px;"><input type="number" id="inp-${q.inputs[1].key}" class="test-input" placeholder="${q.inputs[1].placeholder}"></div><button class="btn-next-q" onclick="saveDoubleInputAndNext('${q.inputs[0].key}', '${q.inputs[1].key}')">Devam Et <i class="fas fa-arrow-right"></i></button>`;
            }
        }
        function nextStep(qId, val) { if (qId === 4) userData.complaint = val; else userData[`q${qId}`] = val; checkFinish(); }
        function saveInputAndNext(key) { const val = document.getElementById(`inp-${key}`).value; if(!val) { showToast("Lütfen bir değer girin."); return; } userData[key] = val; checkFinish(); }
        function saveDoubleInputAndNext(key1, key2) { const val1 = document.getElementById(`inp-${key1}`).value; const val2 = document.getElementById(`inp-${key2}`).value; if(!val1 || !val2) { showToast("Lütfen tüm alanları doldurun."); return; } userData[key1] = val1; userData[key2] = val2; checkFinish(); }
        function checkFinish() { if (currentQIndex < questions.length - 1) { currentQIndex++; renderQuestion(); } else { calculateResult(); } }
        function calculateResult() {
            document.getElementById('p-bar').style.width = '100%'; document.getElementById('quiz-area').style.display = 'none'; document.getElementById('step-result').style.display = 'block';
            const boy = parseFloat(userData.height) / 100; const kilo = parseFloat(userData.weight); const bmi = (kilo / (boy * boy)).toFixed(1);
            let bmiText = `BMI Endeksiniz: <strong>${bmi}</strong> - `;
            if(bmi < 18.5) bmiText += "Zayıf"; else if(bmi < 25) bmiText += "İdeal Kilo"; else if(bmi < 30) bmiText += "Hafif Kilolu"; else bmiText += "Obezite Riski";
            document.getElementById('bmi-result').innerHTML = bmiText;
            let resultTitle = "", resultDesc = "";
            switch(userData.complaint) {
                case 'yorgunluk': if (userData.gunes_az === 'gunes_az' || userData.q1 === 'F') { resultTitle = "D Vitamini + Demir + B12"; resultDesc = "D vitamini eksikliği ve demir depolarının boşalması olabilir."; } else if (userData.stres_yuksek === 'stres_yuksek') { resultTitle = "Magnezyum Malat + Rhodiola"; resultDesc = "Strese bağlı yorgunluk. Magnezyum gevşetir, Rhodiola adaptojen etki sağlar."; } else { resultTitle = "Multivitamin Kompleks (Ginseng)"; resultDesc = "Genel enerji düşüklüğü için Ginseng içeren destek."; } break;
                case 'sac_cilt': if (userData.q10 === 'toksik' || userData.dengesiz === 'dengesiz') { resultTitle = "Biotin + Çinko + Antioksidan"; resultDesc = "Toksin atımı ve hücre yenilenmesi için antioksidan."; } else { resultTitle = "Kolajen (Tip 1-3) + Hyaluronik Asit"; resultDesc = "Cilt elastikiyeti ve saç kökleri için hidrolize kolajen."; } break;
                case 'uyku': if (userData.stres_yuksek === 'stres_yuksek') { resultTitle = "Magnezyum Glisinat + Melisa"; resultDesc = "Stres hormonlarını dengeleyerek doğal uyku."; } else { resultTitle = "Melatonin (3mg) + Pasiflora"; resultDesc = "Uyku döngüsünü düzenlemek için kısa süreli destek."; } break;
                case 'eklem': if (parseFloat(userData.age) > 50 || bmi > 30) { resultTitle = "Glukozamin + Kondroitin + MSM"; resultDesc = "Eklemlere binen yükü hafifletmek için tam koruma."; } else { resultTitle = "Omega 3 + Kurkumin"; resultDesc = "Eklemlerdeki yangıyı azaltmak için doğal antienflamatuar."; } break;
                default: resultTitle = "Günlük Multivitamin"; resultDesc = "Bağışıklık sisteminizi korumak için standart destek.";
            }
            document.getElementById('result-title').innerText = resultTitle; document.getElementById('result-desc').innerText = resultDesc;
        }
        function resetTest() { showKvkkScreen(); }

        // --- GİRİŞ & ÇIKIŞ SİSTEMİ ---
        async function performLogin() {
            const glnInput = document.getElementById('gln-input').value;
            if(!glnInput) { showToast("Lütfen GLN giriniz."); return; }
            try {
                const res = await fetch(`${API_URL}/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ gln: glnInput }) });
                const data = await res.json();
                if(data.success) {
                    closeModal('login-modal');
                    document.getElementById('header-title').innerText = `Hoş geldin, ${data.user.name}`;
                    document.getElementById('header-sub').innerText = `${data.user.pharmacy} Yönetim Paneli`;
                    document.getElementById('header-user').innerText = data.user.name;
                    document.getElementById('header-avatar').classList.add('pharmacist');
                    document.getElementById('admin-link').style.display = 'block';
                    localStorage.setItem('pharmacistName', data.user.name);
                    showToast("Giriş Onaylandı");
                    navTo('admin'); renderAdmin();
                } else { alert("HATA: " + data.message); }
            } catch (error) { alert("Sunucuya bağlanılamadı!"); }
        }
        function performLogout() {
            document.getElementById('header-title').innerText = "Merhaba"; document.getElementById('header-sub').innerText = "Bugün sağlığın için ne yapmak istersin?";
            document.getElementById('header-user').innerText = "Giriş Yapılmadı"; document.getElementById('header-avatar').classList.remove('pharmacist');
            document.getElementById('admin-link').style.display = 'none'; localStorage.removeItem('pharmacistName');
            showToast("Güvenli Çıkış Yapıldı"); navTo('home');
        }

        // --- FORUM & ADMIN & CHAT & UI ---
        async function renderForum() {
            try {
                const res = await fetch(`${API_URL}/forum/list`); const posts = await res.json();
                const container = document.getElementById('forum-container'); container.innerHTML = "";
                const answeredPosts = posts.filter(p => p.status === 'answered');
                if(answeredPosts.length === 0) container.innerHTML = `<p style="text-align:center; color:#999; padding:20px;">Henüz yanıtlanmış soru yok.</p>`;
                answeredPosts.forEach(post => { container.innerHTML += `<div class="forum-post"><div style="font-weight: 700; margin-bottom: 5px;">${post.topic} <span style="font-weight:400; color:#999; font-size:12px;">• Misafir</span></div><p style="font-size: 14px; margin-bottom: 15px;">${post.text}</p><div style="background: #f8fbff; padding: 15px; border-radius: 12px; border-left: 4px solid var(--accent-color);"><div class="verified-badge"><i class="fas fa-certificate"></i> ${post.pharmacist}</div><p style="margin: 5px 0 0; font-size: 14px; color: #444;">${post.answer}</p></div></div>`; });
            } catch (e) {}
        }
        async function submitQuestion() {
            const topic = document.getElementById('q-topic').value; const text = document.getElementById('q-text').value;
            if(topic && text) { await fetch(`${API_URL}/forum/ask`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ topic, text }) }); closeModal('ask-modal'); showToast("Soru Gönderildi!"); renderAdmin(); }
        }
        async function renderAdmin() {
            try {
                const res = await fetch(`${API_URL}/forum/list`); const posts = await res.json();
                const container = document.getElementById('admin-container'); const pending = posts.filter(p => p.status === 'pending');
                if(pending.length === 0) { container.innerHTML = `<p style="text-align:center; color:#999;">Bekleyen soru yok.</p>`; return; }
                container.innerHTML = "";
                pending.forEach(post => { container.innerHTML += `<div class="admin-card"><div class="admin-header"><span style="background:#fff3cd; color:#856404; padding:3px 8px; border-radius:10px; font-size:11px;">Bekliyor</span></div><h4 style="margin:0 0 5px;">${post.topic}</h4><p style="color:#555; font-size:13px; margin-bottom:10px;">"${post.text}"</p><textarea id="ans-${post._id}" class="admin-input" rows="2" placeholder="Cevap yaz..."></textarea><button class="btn-primary" style="font-size:12px; padding:8px 20px;" onclick="submitAnswer('${post._id}')">Yayınla</button></div>`; });
            } catch (e) {}
        }
        async function submitAnswer(id) {
            const text = document.getElementById(`ans-${id}`).value; const pName = localStorage.getItem('pharmacistName') || "Eczacı";
            if(text) { await fetch(`${API_URL}/admin/answer`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id, answer: text, pharmacist: pName }) }); showToast("Cevap Yayınlandı!"); renderAdmin(); renderForum(); }
        }
        function handleEnter(e) { if(e.key === 'Enter') sendAiMessage(); }
        async function sendAiMessage() {
            const input = document.getElementById('ai-input'); const msg = input.value; if(!msg) return;
            const chatBox = document.getElementById('ai-messages'); chatBox.innerHTML += `<div class="msg user">${msg}</div>`; input.value = ""; chatBox.scrollTop = chatBox.scrollHeight;
            try { const res = await fetch(`${API_URL}/chat`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({message: msg}) }); const data = await res.json(); setTimeout(() => { chatBox.innerHTML += `<div class="msg bot">${data.reply}</div>`; chatBox.scrollTop = chatBox.scrollHeight; }, 500); } catch (e) { chatBox.innerHTML += `<div class="msg bot">Bağlantı hatası.</div>`; }
        }
        function navTo(pageId, btnElement) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active')); document.getElementById('page-' + pageId).classList.add('active');
            if(btnElement) { document.querySelectorAll(btnElement.classList.contains('nav-btn') ? '.nav-btn' : '.mob-link').forEach(el => el.classList.remove('active')); btnElement.classList.add('active'); }
            window.scrollTo({ top: 0, behavior: 'smooth' }); if(pageId === 'test') showKvkkScreen();
        }
        function openLoginModal() { document.getElementById('login-modal').style.display = 'flex'; }
        function openAskModal() { document.getElementById('ask-modal').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function showToast(msg) { const t = document.getElementById("toast"); t.innerText = msg; t.className = "show"; setTimeout(() => t.className = t.className.replace("show", ""), 3000); }
        function toggleFaq(element) { element.parentElement.classList.toggle('active'); }
    </script>
</body>
</html>